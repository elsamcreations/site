<!DOCTYPE html>
<html>
<head>
  <title>Give a Sheet</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘•</text></svg>">
  <style>

* {
  box-sizing: border-box;
}

/* latin */
@font-face {
  font-family: 'Poppins';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/poppins/v15/pxiEyp8kv8JHgFVrJJfecg.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Permanent Marker';
  font-style: normal;
  font-weight: 400;
  src: url(data:font/woff2;base64,d09GMgABAAAAAAUkAA0AAAAACGwAAATUAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAPAgCCYJhCoUshBoLDAABNgIkAxQEIAWEGgcgDAcb5wYR1aQeyDRSFs7f7+/dyveB85bdE5KZz4oecYWNGj8iMr3pjxgLJyIv7lWcO6pY06TL4APvaS+dkZuVdqBwIr8A9yaOmS5ANhxGi21KHQ1WgBOKSJr4zr/A8YexCxO4AkQhh1yHHADhmcAB4LLkJD9h9IPAkjpI4C593uLlMAMojBYO+m9hqnSYGPkw4Yjwj0cLUasDRZ0MIgGXQYIEYS5IQECQ+X7J1JG+7//1v/XxWQGE8gVYsNS8TchV9oj4Z1EfertA3LRRQ1JOqbFHR7JZQ6EcSUrVUCynGRSjmeVmmFFO+bztnGbo7i3bUYpm6O4t25eb4R2cDacIK8w9FGGlqeIMpuyhCCu96B2MTdJQagIsiTmDCrq3MngvhcD5r2FO+YL3xdhSc5mJJ3QFZ+hMUVVq4KulJr7SFZUxDXPHF0epcXRPyUgBef7clIb5taesMHGGgsA4Dy0Iq3iCc4WHGU3iVd9HBEiiGTkoRo1H5MTSVOuJsKrAo8JqWGWKynQNC8oXrDANXVEBT1tiXo4pKNwi+x8AEusGkLb9P5kAGbvC3FT5ONo7oJ5wXXeI1VBqdch2W0tL0O6qqio+WVjveZ43OOxklW0Hneqg4zhOcVE2e6i1tuNe0LJk1105OL/rTlOz4nlrur+k2/i7dxH7QcyuqjsZdKqLH3oDAxMre6OVtaXoTuh4FLEsueVRxOqQWx8+fBht98a2f4xmKwNWdtNHz/OMzteaZclWh9zyKNFyr+T+p9e3S62KQEVHyb0EJx2u62ZsW7btoFNfXx13soFL3od3L2qt3blzRXZ8enycHFpYWBBd2qM6NDY2Tg4NiQ+v77i5qMnnxBUdQvH4CHuQ7qtPnodenfwbKM+gMZyJk3EuPLw6ZIhMgLQ/vy+7ryk/jV9GzdNZgz2kJIVdfIWJI5vLWbK8X5KnxGP4z2slcHvS9G0dzUsK9G1zSpwp14KkB3a/q+1/zDrt7xaSM6043/Y2VzCfSJeccv+YMv9T1cDFxZNxV0BfWk9un9wFrvtiCo6JNucd+RUeptWdOn9LUwNKy2np4hkCuWzPWiMgzkd6sHp2XvUhM3r5SN/9W2SjNRNSFqgwbtanvtKRAsmEgV5wjekV0+nUJqZqjpStmifNkfu0/13vTW7kQL2TfuSFt3aKQS5xDnOSkmFS4eviMsortQAAEAAI2IncjjOLFrD4xsnDCgA4b+gmb++8rXXpLvMu8yDrV9YcAFyvBID4A9Yc5kHIsT5g3mWOsn59MCgIwkaU0/RJbhCljcGCZv3/W4lYNoIODoL3SWCcRisNRL4RBYATSY+HhJULGYoIKx9NQJ6QRdPATwiiWeCAS2hWMDCBZoMk6tDsoBDA4ac2AykoQAFyYAY66ChWPRRikUO/Eo8UJIJCNvKQDDoykIp4JCIL+TQZjqbDA66whyO84A8v0YEeKDDgg0TkIROxyCqZWwBPxCIP6WkaHfhRyGQUIgMcFJ2PVGQj6zmk1R/EgG4bnfI0KfmyWl+lORzgCi/4wXwkVUIN9T7ZHtnIQSnykIrkdZwkD3XEQwPy0BvFJAbkEYdSyMNpbtRcnQNS24LmQTvSFVmIBwU9tshABlXWEi8/RF1nasnYIiQiAdR7RWGH/d8JfSi0H0PK2gk=) format('woff2');
}

body, html {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  font-size: 22px;
}

h1 { border-bottom: 10px solid }

header, section > div {
  margin: 120px 140px;
}

section {
  min-height: 400px;
  position: relative;
  overflow: hidden;
}

section:before {
  font-size: 400px;
  display: inline-block;
  position: absolute;
  margin-left: 0.15em;
  color: #0004;
  top: -0.25em;
  text-align: center;
  width: 1em;
  font-family: 'Permanent Marker';
  pointer-events: none;
}

#sheets:before { content: '1' }
#sheets { background: #fe8 }

#type:before { content: '2' }
#type { background: #8ef }

#checkout:before { content: '3' }
#checkout { background: #f8e }

/*
https://media.discordapp.net/attachments/315112005591760896/841307470471495730/DSCN1451.JPG?width=959&height=719
https://media.discordapp.net/attachments/315112005591760896/841307475785416754/DSCN1453.JPG?width=959&height=719
https://media.discordapp.net/attachments/315112005591760896/841307481044287528/DSCN1454.JPG?width=959&height=719
https://media.discordapp.net/attachments/315112005591760896/837745244245065788/DSCN1446.JPG?width=959&height=719
*/

#sheets h2 { width: 100% }
#sheets > div {
  display: flex;
  justify-content: left;
  flex-wrap: wrap;
  gap: 24px;
}

.preview, .sheet {
  background-color: #000;
}

.sheet {
  max-width: 328px;
  width: 100%;
  border: solid;
  overflow: hidden;
}

.sheet .previews {
  flex-shrink: 0;
  display: flex;
  align-items: end;
  gap: 2px;
}

.sheet .slider {
  display: flex;
  margin-bottom: 2px;
  transition: transform 200ms cubic-bezier(.23,1,.32,1);
  user-drag: none;
}

.sheet .slider div {
  background-size: 100%;
  background-repeat: no-repeat;
  flex-shrink: 0;
  width: 100%;
  padding-top: calc(min(100%, 328px));
  box-shadow: black 0 0 0 1px inset;
}

.sheet:active, .sheet:focus-within {
  outline: 5px solid;
}

.sheet input[type="radio"] {
  opacity: 0;
  position: fixed;
}
.sheet label {
  height: 46px;
  width: 100%;
}

.sheet input[type="radio"]:not(:checked) + .preview { opacity: 0.66 }
.sheet input[type="radio"]:not(:checked) + .preview:active { opacity: 0.33 }
.preview {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
}

@media screen and (max-width: 1400px) {
  header, section > div {
    margin: 120px calc(max(35px, 10%));
  }
}
  </style>
</head>
<body>
  <header>
    <h1>Give a Sheet</h1>
    <ol>
      <li>Give a Sheet</li>
      <li>Get a Shirt</li>
    </ol>
  </header>
  <section id="sheets">
    <template id="sheet">
      <div class="sheet">
        <div class="slider"></div>
        <div class="previews"></div>
      </div>
    </template>
    <template id="preview">
      <label>
        <input type="radio">
        <div class="preview"></div>
      </label>
    </template>
    <div>
      <h2>Pick your Sheet</h2>
    </div>
  </section>

  <section id="type">
    <div>
      <h2>Choose your Clothing</h2>
    </div>
  </section>

  <section id="checkout">
    <div>
      <h2>Configure and Checkout</h2>
    </div>
  </section>
  <footer></footer>

<script type="module">
const templatesEntries =
  [...document.getElementsByTagName('template')].map(t => {
    const elem = t.content.firstElementChild
    return [t.id, () => elem.cloneNode(true)]
  })

const makeImageUrl = (filename, sheet) => 
  `url(https://dev.oct.ovh:2096/wow/photo?filename=${filename}&sheet=${sheet}&size=328)`


let resetCurrent
addEventListener('mousemove', e => {
  if (e.buttons || !resetCurrent) return
  setTimeout(resetCurrent)
})
const sheetMaker =  (couette) => {
  if (!couette.photos.length) return ''
  const sheet = templates.sheet()
  sheet.id = couette.name

  // TODO: change how the file is hosted
  // sheet.onmouseup = () => sheet.firstElementChild.focus()

  const [previews] = sheet.getElementsByClassName('previews')
  const [slider] = sheet.getElementsByClassName('slider')
  const slideTo = n => slider.style.transform = `translate(${n}%)`
  const inputs = couette.photos.map((href, i) => {
    const label = templates.preview()
    const [preview] = label.getElementsByTagName('div')
    const [input] = label.getElementsByTagName('input')
    const url = makeImageUrl(href, couette.name)
    preview.style.backgroundImage = url
    input.name = couette.name
    input.checked = !i
    label.onclick = () => {
      input.checked = true
      slideTo(offset = -100*i)
    }
    return label
  })

  let offset = 0
  let width = 324
  let time = 0
  let startX, startY, x
  const move = () => slideTo(((x - startX)/width)*100 + offset)

  slider.onmouseup = slider.ontouchend = slider.ontouchcancel = () => {
    let dist = startX - x || 0
    let delay = Date.now() - time
    if (Math.abs(dist) < 20 && delay < 250) {
      const dir = Math.sign((startX - slider.offsetLeft) - width / 2)
      const input = inputs[(-offset)/100 + dir]
      console.log({dir, input})
      input && input.click()
    }

    if (!reset() && Math.abs(dist) < (width / 3) - Math.max(250 - delay, 0)) return
    const input = inputs[(-offset)/100 + Math.sign(dist)]
    input && input.click()
  }

  const reset = () => {
    if (!startX) return true
    x = startX = resetCurrent = undefined
    slideTo(offset)
  }

  const start = (initX) => {
    startX = initX
    time = Date.now()
    resetCurrent = reset
  }

  slider.onmousedown = (e) => start(e.x)
  slider.onmousemove = (e) => startX && e.buttons && move(x = e.x)
  slider.ontouchmove = (e) => {
    if (!startX) return
    let y = e.touches[0].pageY
    x = e.touches[0].pageX
    if (Math.abs(startX - x) > Math.abs(startY - y)) {
      move()
      e.preventDefault()
    } else {
      startX = undefined
    }
  }

  slider.ontouchstart = (e) => {
    startY = e.touches[0].pageY
    start(e.touches[0].pageX)
  }

  slider.append(...couette.photos.map((href, i) => {
    const image = document.createElement('div')
    const url = makeImageUrl(href, couette.name)
    image.style.backgroundImage = url
    return image
  }))

  previews.append(...inputs)

  return sheet
}

const templates = Object.fromEntries(templatesEntries)
const couettes = [{"name":"101-dalmatians","info":"","photos":["dscn1392.jpg","dscn1393.jpg","dscn1394.jpg","dscn1395.jpg"],"createdAt":1620682234148.1243},{"name":"action-man","info":"Partly used","photos":["dscn1402.jpg","dscn1409.jpg","dscn1408.jpg","dscn1407.jpg","dscn1406.jpg","dscn1405.jpg","dscn1404.jpg","dscn1403.jpg"],"createdAt":1620681228887.5159},{"name":"ddp","info":"","photos":["dscn1397.jpg","dscn1398.jpg","dscn1399.jpg","dscn1400.jpg","dscn1401.jpg"],"createdAt":1620681873875.1963},{"name":"digimon","info":"","photos":["dscn1422.jpg","dscn1419.jpg","dscn1420.jpg","dscn1421.jpg"],"createdAt":1620681019507.3127},{"name":"disney-princess","info":"","photos":["dscn1425.jpg","dscn1426.jpg","dscn1423.jpg","dscn1424.jpg"],"createdAt":1620681041734.9175},{"name":"nemo","info":"","photos":["dscn1375.jpg","dscn1373.jpg","dscn1374.jpg","dscn1378.jpg","dscn1377.jpg","dscn1376.jpg"],"createdAt":1620683508653.344},{"name":"noddy","info":"","photos":["dscn1382.jpg","dscn1380.jpg","dscn1384.jpg","dscn1383.jpg","dscn1381.jpg"],"createdAt":1620683115200.3074},{"name":"om","info":"","photos":["dscn1412.jpg","dscn1410.jpg","dscn1411.jpg","dscn1413.jpg","dscn1414.jpg"],"createdAt":1620681166276.667},{"name":"pirate","info":"","photos":["dscn1418.jpg","dscn1417.jpg","dscn1415.jpg","dscn1416.jpg"],"createdAt":1620681110425.683},{"name":"teletubbies","info":"","photos":["dscn1372.jpg","dscn1369.jpg","dscn1370.jpg","dscn1371.jpg"],"createdAt":1620683420326.946},{"name":"tintin-3d","info":"","photos":["dscn1390.jpg","dscn1391.jpg","dscn1389.jpg"],"createdAt":1620682322430.3818},{"name":"winnie-the-pooh","info":"","photos":["dscn1388.jpg","dscn1385.jpg","dscn1386.jpg","dscn1387.jpg"],"createdAt":1620682867488.3577}]

document.querySelector('#sheets > div')
  .append(...couettes.map(sheetMaker))

  </script>
</body>
</html>

<!--
<script src="https://js.stripe.com/v3"></script>
<script>
let stripe = Stripe('pk_test_51IinC4DDpZZcA4TdpugUkXBcmtRRtVdJzNS1848tKPzfwOSKtk38oERfhRs2O4KEDBAfLZcuphK7aUQwXcQOMj2J00UTM90XhD')

function setStripe(id, items) {
  document.getElementById(id).addEventListener('click', function () {
    stripe.redirectToCheckout({
      items: items,
      successUrl: 'https://traitedelutherie.com/success',
      cancelUrl: 'https://traitedelutherie.com/canceled',
    })
    .then(function (result) {
      if (result.error) {
        let displayError = document.getElementById('error-message')
        displayError.textContent = result.error.message
      }
    })
  })
}

setStripe('checkout-button-230', [
  {sku: 'sku_EnciNWzNmYYbh8', quantity: 1},
  {sku: 'sku_EnclvkJ8hiu8Iz', quantity: 1},
])

setStripe('checkout-button-215', [
  {sku: 'sku_EnciNWzNmYYbh8', quantity: 1},
  //{sku: 'sku_EnclvkJ8hiu8Iz', quantity: 1},
])
-->